<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>登录</title>
<link href=".//layui/css/layui.css" rel="stylesheet">
<script src=".//layui/layui.js"></script>
<script src=".//js/jquery-3.6.0.min.js"></script>
<style>
.demo-login-container {
	width: 320px;
	margin: 18px auto 0;
}

.demo-reg-other .layui-icon {
	position: relative;
	display: inline-block;
	margin: 0 2px;
	top: 2px;
	font-size: 26px;
}
body {
	margin: 200px auto;
    text-align: center; 
}
.bottom{
		margin: 80px auto;
}
a {
    color: #0071ce;
}
</style>
</head>
<body>
	<div class="top">
		<h1>登录帐户</h1>
		<div class="layui-form-item demo-reg-other">
			新用户?<a href="Register.html">现在注册</a>
		</div>
	</div>
	<div class="bottom">
		<form class="layui-form">
			<div class="demo-login-container">
				<div class="layui-form-item">
					<div class="layui-input-wrap">
						<div class="layui-input-prefix">
							<i class="layui-icon layui-icon-username"></i>
						</div>
						<input type="text" name="username" value="" lay-verify="required"
							placeholder="用户名" lay-reqtext="请填写用户名" autocomplete="off"
							class="layui-input" lay-affix="clear">
					</div>
				</div>
				<div class="layui-form-item">
					<div class="layui-input-wrap">
						<div class="layui-input-prefix">
							<i class="layui-icon layui-icon-password"></i>
						</div>
						<input type="password" name="password" value=""
							lay-verify="required" placeholder="密   码" lay-reqtext="请填写密码"
							autocomplete="off" class="layui-input" lay-affix="eye">
					</div>
				</div>
				<div class="layui-form-item">
					<button class="layui-btn layui-btn-fluid" lay-submit
						lay-filter="demo-login">登录</button>
				</div>
			</div>
		</form>
	</div>
</body>

<script>
layui.use(function() {
    var form = layui.form;
    var layer = layui.layer;
    
    // 提交事件
    form.on('submit(demo-login)', function(data) {
        // 获取表单字段值
        var name = data.field.username;
        var password = data.field.password;
        
        $.ajax({
            url: 'CheckLoginServlet', // 通讯地址
            type: 'post', // 请求方式
            data: {
                'name': name,
                'password': password
            },
            dataType: "json",
            success: function(res) {
                // 后端返回结构为 {code:0, msg:"success", data:[role]}
                if (res.code === 0 && res.msg === "success") {
                    // 获取角色信息（data是集合，取第一个元素）
                    var role = res.data[0];
                    var entity = role === '0' ? '管理员' : '用户';
                    
                    layer.msg(entity + '登录成功', {
                        icon: 1,
                        time: 2000
                    }, function() {
                        // 根据角色跳转不同页面
                        if (role === "0") {
                            window.location.href = "pages/MainForm.html";
                        } else {
                            window.location.href = "pages/UserForm.html";
                        }
                    });
                } else {
                    layer.msg('用户名或密码错误', {
                        icon: 2,
                        time: 2000
                    });
                }
            },
            error: function() {
                layer.msg('登录请求失败，请重试', {
                    icon: 2,
                    time: 2000
                });
            }
        });

        return false; // 阻止默认表单提交
    });
});
</script>
</html>