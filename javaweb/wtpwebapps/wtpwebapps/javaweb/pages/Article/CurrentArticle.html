<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>当前文章</title>
<link href="../..//layui/css/layui.css" rel="stylesheet">
<script src="../..//layui/layui.js"></script>
<script src="../..//js/jquery-3.6.0.min.js"></script>
<style>
/* 自定义样式 */
.article-container {
	padding: 20px;
	max-width: 1200px;
	margin: 0 auto;
}

.article-content {
	line-height: 1.8;
	font-size: 16px;
	padding: 20px;
	background: #fff;
	border-radius: 2px;
	box-shadow: 0 2px 12px 0 rgba(0, 0, 0, .1);
}

.article-title {
	margin-bottom: 20px;
	padding-bottom: 10px;
	border-bottom: 1px solid #eee;
}
</style>
</head>
<body>
	<!-- 使用 Layui 布局容器 -->
	<div class="layui-container article-container">
		<!-- 卡片面板 -->
		<div class="layui-card">
			<div class="layui-card-header">
				<div class="layui-row">
					<div class="layui-col-md6">
						<h1 id="title" class="article-title"></h1>
					</div>
					<div class="layui-col-md6" style="text-align: right;">
						<button class="layui-btn layui-btn-primary" id="btn-back">
							<i class="layui-icon layui-icon-return"></i> 返回
						</button>
					</div>
				</div>
			</div>

			<div class="layui-card-body">
				<div id="content" class="article-content"></div>

				<div class="layui-row">
					<div class="layui-col-md4" style="text-align: right;">
						<button class="layui-btn layui-btn-primary" id="btn-like">
							<i class="layui-icon layui-icon-praise"></i> 点赞
						</button>
					</div>
					<div class="layui-col-md4" style="text-align: center;">
						<button class="layui-btn layui-btn-primary" id="btn-favorite">
							<i class="layui-icon layui-icon-rate"></i> 收藏
						</button>
					</div>
					<div class="layui-col-md4" style="text-align: left;">
						<button class="layui-btn layui-btn-primary" id="btn-copelink">
							<i class="layui-icon layui-icon-link"></i> 复制链接
						</button>
					</div>
				</div>

				<div id="comments" class="article-footer">
					<h1>评论</h1>
				</div>
			</div>

		</div>
	</div>

	<script>
		// 加载 Layui 模块
		layui.use([ 'layer', 'element' ], function() {
			var layer = layui.layer;
			var element = layui.element;
			// 从 URL 中解析 draftId
			var urlParams = new URLSearchParams(window.location.search);
			var titleId = urlParams.get('titleId');

			// 显示加载层
			var loadIndex = layer.load(1, {
				shade : 0.3
			});

			// 页面加载时执行
			$(document).ready(function() {
				if (!titleId) {
					layer.alert("缺少文章ID参数", {
						icon : 2
					});
					return;
				}

				// 发送 AJAX 请求到 ShowArticleServlet
				$.ajax({
					url : '../../ShowArticleServlet',
					type : 'POST',
					data : {
						titleId : titleId
					},
					dataType : 'json',
					success : function(data) {
						layer.close(loadIndex); // 关闭加载层
						if (data.code === 0 && data.data.length > 0) {
							// 解析字符串为对象
							const article = data.data[0];
							const topic = article.topic;
							const dataHtml = article.data_html;

							$('#title').text(topic);
							$('#content').html(dataHtml);
						} else {
							layer.alert("加载失败：" + data.msg, {
								icon : 2
							});
						}
					},
					error : function(xhr, status, error) {
						layer.close(loadIndex);
						console.log('AJAX 请求错误:', error); // 打印错误信息
						layer.alert("请求失败：" + error, {
							icon : 2
						});
					}
				});
			});

			// 返回按钮点击事件
			$('#btn-back').click(function() {
				window.history.back();
			});
			
			
			
			// 复制按钮点击事件
			$('#btn-copelink').click(function() {
				navigator.clipboard.writeText(window.location.href)
				.then(() => {
					layer.msg('复制链接成功', {icon: 1});
				})
				.catch((err) => {
					layer.msg('复制链接失败: ' + err, {icon: 2});
				});
			});
		});
	</script>
</body>
</html>