<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>当前审核文章</title>
<link href="../..//layui/css/layui.css" rel="stylesheet">
<script src="../..//layui/layui.js"></script>
<script src="../..//js/jquery-3.6.0.min.js"></script>
<style>
/* 自定义样式 */
.article-container {
	padding: 20px;
	max-width: 1200px;
	margin: 0 auto;
}

.article-content {
	line-height: 1.8;
	font-size: 16px;
	padding: 20px;
	background: #fff;
	border-radius: 2px;
	box-shadow: 0 2px 12px 0 rgba(0, 0, 0, .1);
}

.article-title {
	margin-bottom: 20px;
	padding-bottom: 10px;
	border-bottom: 1px solid #eee;
}
</style>
</head>
<body>
	<!-- 使用 Layui 布局容器 -->
	<div class="layui-container article-container">
		<!-- 卡片面板 -->
		<div class="layui-card">
			<div class="layui-card-header">
				<div class="layui-row">
					<div class="layui-col-md6">
						<h1 id="title" class="article-title"></h1>
					</div>
					<div class="layui-col-md6" style="text-align: right;">
						<button class="layui-btn layui-btn-primary" id="btn-del">
							<i class="layui-icon layui-icon-delete"></i> 删除
						</button>
						<button class="layui-btn layui-btn-primary" id="btn-notpass">
							<i class="layui-icon layui-icon-close"></i>审核不通过
						</button>
						<button class="layui-btn layui-btn-primary" id="btn-pass">
							<i class="layui-icon layui-icon-release"></i> 审核通过
						</button>
						<button class="layui-btn layui-btn-primary" id="btn-back">
							<i class="layui-icon layui-icon-return"></i> 返回列表
						</button>
					</div>
				</div>
			</div>
			<div class="layui-card-body">
				<div id="content" class="article-content"></div>
			</div>
		</div>
	</div>

	<script>
		// 加载 Layui 模块
		layui.use([ 'layer', 'element' ], function() {
			var layer = layui.layer;
			var element = layui.element;
			// 从 URL 中解析 titleId
			var urlParams = new URLSearchParams(window.location.search);
			var titleId = urlParams.get('titleId');

			// 显示加载层
			var loadIndex = layer.load(1, {
				shade : 0.3
			});

			// 页面加载时执行
			$(document).ready(function() {
				if (!titleId) {
					layer.alert("缺少草稿ID参数", {
						icon : 2
					});
					return;
				}

				$.ajax({
					url : '../../ShowArticleServlet',
					type : 'GET',
					data : {
						titleId : titleId
					},
					dataType : 'json',
					success : function(data) {
						layer.close(loadIndex); // 关闭加载层
						if (data.code === 0 && data.data.length > 0) {
							// 解析字符串为对象
							const article = data.data[0];
							const topic = article.topic;
							const dataHtml = article.data_html;

							$('#title').text(topic);
							$('#content').html(dataHtml);
						} else {
							layer.alert("加载失败：" + data.msg, {
								icon : 2
							});
						}
					},
					error : function(xhr, status, error) {
						layer.close(loadIndex);
						console.log('AJAX 请求错误:', error); // 打印错误信息
						layer.alert("请求失败：" + error, {
							icon : 2
						});
					}
				});
			});

			$('#btn-del').click(function() {
				layer.confirm('确定要删除这篇文章吗？', {
					icon : 3,
					title : '提示'
				}, function(index) {
					$.ajax({
						url : '../../DeleteArticleServlet',
						type : 'GET',
						data : {
							titleId : titleId
						},
						dataType : 'text',
						success : function(res) {
							if (res == "success") {
								layer.close(loadIndex);
								layer.msg('删除成功', {
									icon : 1
								});
								window.history.back(); // 返回上一页面
							} else {
								layer.msg('删除失败', {
									icon : 2
								});
							}
						},
						error : function(xhr, status, error) {
							layer.close(loadIndex);
							console.log('AJAX 请求错误:', error); // 打印错误信息
							layer.alert("请求失败：" + error, {
								icon : 2
							});
						}
					})
				})
			});

			$('#btn-notpass').click(function() {
				layer.confirm('确定审核不通过这篇文章吗？', {
					icon : 3,
					title : '提示'
				}, function(index) {
					$.ajax({
						url : '../../ReviewArticleServlet',
						type : 'GET',
						data : {
							titleId : titleId,
							passCode : 2
						},
						dataType : 'text',
						success : function(res) {
							if (res == "success") {
								layer.close(loadIndex);
								layer.msg('审核不通过', {
									icon : 1
								});
								window.history.back(); // 返回上一页面
							} else {
								layer.msg('审核失败', {
									icon : 2
								});
							}
						},
						error : function(xhr, status, error) {
							layer.close(loadIndex);
							console.log('AJAX 请求错误:', error); // 打印错误信息
							layer.alert("请求失败：" + error, {
								icon : 2
							});
						}
					})
				})
			});

			$('#btn-pass').click(function() {
				layer.confirm('确定审核通过这篇文章吗？', {
					icon : 3,
					title : '提示'
				}, function(index) {
					$.ajax({
						url : '../../ReviewArticleServlet',
						type : 'GET',
						data : {
							titleId : titleId,
							passCode : 1
						},
						dataType : 'text',
						success : function(res) {
							if (res == "success") {
								layer.close(loadIndex);
								layer.msg('审核通过', {
									icon : 1
								});
								window.history.back(); // 返回上一页面
							} else {
								layer.msg('审核失败', {
									icon : 2
								});
							}
						},
						error : function(xhr, status, error) {
							layer.close(loadIndex);
							console.log('AJAX 请求错误:', error); // 打印错误信息
							layer.alert("请求失败：" + error, {
								icon : 2
							});
						}
					})
				})
			});

			// 返回按钮点击事件
			$('#btn-back').click(function() {
				window.history.back();
			});
		});
	</script>
</body>
</html>