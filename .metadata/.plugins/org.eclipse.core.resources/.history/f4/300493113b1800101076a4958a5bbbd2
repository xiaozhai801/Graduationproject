package com.zpq.dao;

import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.util.ArrayList;
import java.util.List;

import com.zpq.pojo.Article;
import com.zpq.utils.DBUtil;

public class PersonalInfoDaoImpl implements PersonalInfoDao {

	@Override
	public List<Object> SelectPerSonalInfo(String name) {
		// TODO Auto-generated method stub
        // 用于存储搜索到的文章对象的列表
        List<Object> searchArticleList = new ArrayList<>();
        // 创建数据库工具类实例
        DBUtil dbUtil = new DBUtil();
        // 使用StringBuilder构建SQL查询语句，初始语句为查询所有记录的基础部分，并添加WHERE 1=1方便后续拼接条件
        StringBuilder sqlBuilder = new StringBuilder("SELECT * FROM v_userinfo");
        int titleId = article.getTitleId();
        String topic = article.getTopic();
        String name = article.getName();
        String model = article.getModel();
        List<Object> params = new ArrayList<>();

        if (titleId != -1) {
            sqlBuilder.append(" AND CAST(titleId AS CHAR) LIKE ?");
            params.add("%" + titleId + "%");
        }
        if (topic != null) {
            sqlBuilder.append(" AND topic LIKE ?");
            params.add("%" + topic + "%");
        }
        if (name != null) {
            sqlBuilder.append(" AND name LIKE ?");
            params.add("%" + name + "%");
        }
        if (model != null) {
            sqlBuilder.append(" AND model LIKE ?");
            params.add("%" + model + "%");
        }

        String sql = sqlBuilder.toString();

        PreparedStatement ps = dbUtil.getPreparedStatement(sql);
        for (int i = 0; i < params.size(); i++) {
            ps.setObject(i + 1, params.get(i));
        }

        ResultSet rs = ps.executeQuery();
        while (rs.next()) {
            Article searchArticle = new Article();
            searchArticle.setTitleId(rs.getInt("titleId"));
            searchArticle.setUserId(rs.getInt("userId"));
            searchArticle.setName(rs.getString("name"));
            searchArticle.setTopic(rs.getString("topic"));
            searchArticle.setModel(rs.getString("model"));
            searchArticle.setUploadTime(rs.getString("uploadTime"));
            searchArticle.setRelease(rs.getInt("release"));
            searchArticle.setViews(rs.getInt("views"));
            searchArticle.setLikes(rs.getInt("likes"));
            searchArticleList.add(searchArticle);
        }
        // 返回搜索到的文章对象列表
        return searchArticleList;
	}

}
