<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>所有文章</title>
    <link href="../../layui/css/layui.css" rel="stylesheet">
    <script src="../../layui/layui.js"></script>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <style>
        html, body {
            overflow: hidden;
            background-color: #f8f9fa;
        }

        /* 表格容器 */
        .layui-table-view {
            margin: 15px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.08);
            border-radius: 8px;
            overflow: hidden;
        }

        /* 表格行样式 */
        .layui-table-body .layui-table-cell {
            height: 60px;
            line-height: 60px !important;
        }

        /* 标题样式 */
        .article-title {
            display: flex;
            align-items: center;
            padding: 10px 0;
        }

        .article-title a {
            font-size: 16px;
            color: #2c3e50;
            font-weight: 500;
            transition: color 0.3s;
        }

        .article-title a:hover {
            color: #3498db;
            text-decoration: none;
        }

        .model-tag.phone { background: #e3f2fd; color: #1976d2; }
        .model-tag.laptop { background: #f0f4c3; color: #827717; }
        .model-tag.game { background: #ffcdd2; color: #c62828; }

        /* 数据统计 */
        .data-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
        }
        .data-item i {
            font-size: 16px;
            color: #95a5a6;
        }

        /* 悬停动画 */
        .layui-table-body .layui-table-row:hover {
            transform: translateX(4px);
            transition: all 0.3s ease;
            background: #fff !important;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }

        /* 搜索栏样式 */
        .layui-form {
            padding: 15px;
            background: #fff;
            margin: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.08);
        }
    </style>
</head>
<body>
    <!-- 搜索表单 -->
    <form class="layui-form layui-row layui-col-space16">
        <div class="layui-form-item">
            <div class="layui-input-inline">
                <input type="text" name="titleId" placeholder="文章ID" class="layui-input">
            </div>
            <div class="layui-input-inline">
                <input type="text" name="topic" placeholder="标题" class="layui-input">
            </div>
            <div class="layui-input-inline">
                <input type="text" name="name" placeholder="作者" class="layui-input">
            </div>
            <div class="layui-input-inline">
                <div class="layui-btn-container">
                    <button class="layui-btn" type="button" id="modelDropdown">
                        <span>机型</span>
                        <i class="layui-icon layui-icon-down layui-font-12"></i>
                    </button>
                </div>
                <input type="hidden" name="model" id="modelInput">
            </div>
            <div class="layui-input-inline">
                <button class="layui-btn" lay-submit lay-filter="searchBtn">
                    <i class="layui-icon layui-icon-search"></i>
                </button>
            </div>
        </div>
    </form>

    <!-- 表格容器 -->
    <table id="articleTable" lay-filter="articleTable"></table>

    <script>
        layui.use(['table', 'form', 'dropdown', 'util'], function () {
            var table = layui.table;
            var form = layui.form;
            var dropdown = layui.dropdown;
            var util = layui.util;
            var $ = layui.$;

            // 初始化机型下拉菜单
            dropdown.render({
                elem: '#modelDropdown',
                data: [
                    { title: '手机', id: 100 },
                    { title: '笔记本电脑', id: 101 },
                    { title: '游戏主机', id: 102 }
                ],
                click: function (obj) {
                    $('#modelDropdown span').text(obj.title);
                    $('#modelInput').val(obj.title);
                }
            });

            // 初始化表格
            table.render({
                elem: '#articleTable',
                url: '../../SelectAllArticleServlet',
                page: true,
                cols: [[
                    { 
                        field: 'topic', 
                        title: '文章', 
                        templet: function (d) {
                            return `
                                <div class="article-title">
                                    ${d.imgUrl ? 
                                        `<img src="${d.imgUrl}" class="article-thumb">` : 
                                        `<div class="article-thumb" style="background:#f0f0f0;"></div>`
                                    }
                                    <a href="CurrentArticle.html?titleId=${d.titleId}">
                                        ${d.topic}
                                    </a>
                                </div>
                            `;
                        }
                    },
                    { 
                        field: 'name', 
                        title: '作者', 
                        width: 120,
                        templet: '<span style="color:#3498db">{{ d.name }}</span>' 
                    },
                    { 
                        field: 'uploadTime', 
                        title: '发布日期', 
                        width: 150,
                        templet: function(d){
                            return util.toDateString(d.uploadTime, "yyyy-MM-dd");
                        }
                    },
                    { 
                        field: 'model', 
                        title: '机型', 
                        width: 120,
                        templet: function(d){
                            let cls = '';
                            if(d.model.includes('手机')) cls = 'phone';
                            if(d.model.includes('笔记本')) cls = 'laptop';
                            if(d.model.includes('游戏')) cls = 'game';
                            return `<span class="model-tag ${cls}">${d.model}</span>`;
                        }
                    },
                    { 
                        field: 'views', 
                        title: '浏览', 
                        width: 100,
                        templet: '<div class="data-item"><i class="layui-icon layui-icon-read"></i>{{ d.views }}</div>'
                    },
                    { 
                        field: 'likes', 
                        title: '点赞', 
                        width: 100,
                        templet: '<div class="data-item"><i class="layui-icon layui-icon-praise"></i>{{ d.likes }}</div>'
                    }
                ]],
                height: 'full-120',
                parseData: function (res) {
                    if (res.code === 0) {
                        res.data = res.data.filter(item => item.release == 1);
                        res.data.forEach(item => {
                            item.views = item.views || 0;
                            item.likes = item.likes || 0;
                        });
                    }
                    return res;
                }
            });

            // 搜索功能
            form.on('submit(searchBtn)', function (data) {
                table.reload('articleTable', {
                    url: '../../SearchArticleServlet',
                    where: {
                        ...data.field,
                        model: $('#modelInput').val()
                    },
                    page: { curr: 1 }
                });
                return false;
            });
        });
    </script>
</body>
</html>