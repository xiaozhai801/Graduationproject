<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>个人信息</title>
<link href=".//layui/css/layui.css" rel="stylesheet">
<script src=".//layui/layui.js"></script>
<script src=".//js/jquery-3.6.0.min.js"></script>
<style>
<style>.layui-nav.layui-nav-tree {
	position: fixed;
	left: 0;
	top: 0;
	width: 200px;
	overflow-y: auto;
}

.layui-form {
	margin-left: 220px;
	padding: 20px;
}
</style>
</head>

<body>
	<ul class="layui-nav layui-nav-tree">
		<li class="layui-nav-item"><a href="javascript:;">个人信息</a></li>
		<li class="layui-nav-item"><a href="javascript:;">修改密码</a></li>
	</ul>
	<form class="layui-form layui-form-pane" action="">
		<div class="layui-card-header">修改密码</div>
		<div class="layui-form-item">
			<label class="layui-form-label">当前密码</label>
			<div class="layui-input-inline">
				<input type="password" name="oldPassword" lay-verify="oldPassword"
					autocomplete="off" class="layui-input" lay-affix="eye">
			</div>
		</div>

		<div class="layui-form-item">
			<label class="layui-form-label">密码</label>
			<div class="layui-input-inline">
				<input type="password" name="newPassword" lay-verify="password"
					autocomplete="off" class="layui-input" lay-affix="eye">
			</div>
			<div class="layui-form-mid layui-word-aux">6到12个字符，且不能出现空格</div>

		</div>

		<div class="layui-form-item">
			<label class="layui-form-label">确认新密码</label>
			<div class="layui-input-inline">
				<input type="password" name="repassword" lay-verify="repassword"
					autocomplete="off" class="layui-input" lay-affix="eye">
			</div>
		</div>

		<div class="layui-form-item">
			<button class="layui-btn" lay-submit lay-filter="confirm">确认</button>
		</div>
	</form>

	<script>
        layui.use(['form', 'layer'], function () {
            var form = layui.form;
            var layer = layui.layer;

            // 自定义验证规则
            form.verify({
                password: function (value) {
                    if (value.length < 6 || value.length > 12) {
                        return '密码长度必须是6到12位';
                    }
                    if (/\s/.test(value)) {
                        return '密码不能包含空格';
                    }
                },
                repassword: function (value) {
                    var password = $('input[name="newPassword"]').val();
                    if (value!== password) {
                        return '两次输入的密码不一致';
                    }
                }
            });

            // 提交事件
            form.on('submit(confirm)', function (data) {
                var field = data.field; //获取表单元素
                $.ajax({
                    url: 'EditPersonalPassword?newPassword=' + field.newPassword + '&oldPassword=' + field.oldPassword,
                    //通讯地址
                    type: 'post',//get或者post 
                    contentType: "application/json;charset=UTF-8",
                    data: {
                        newPassword: field.newPassword,
                        oldPassword: field.oldPassword
                    },//发送到服务端的数据K-V形式
                    dataType: "text",//接收到的数据的类型可以是json或者text
                    success: function (res) {
                        if (res == "success") {
                            layer.msg('修改成功', {
                                icon: 1, // 显示成功图标
                                time: 2000
                                // 提示信息显示 2 秒
                            });
                        } else {
                            layer.msg('修改失败', {
                                icon: 2, // 显示失败图标
                                time: 2000
                                // 提示信息显示 2 秒
                            });
                        }
                    }
                });

                return false;
            });
        });
    </script>
</body>

</html>