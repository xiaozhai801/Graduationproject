package com.zpq.dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;

import com.zpq.pojo.Article;
import com.zpq.utils.DBUtil;

public class ArticleDaoImpl implements ArticleDao {
	//分页显示所有文章
	@Override
	public List<Object> selectArticle(int page, int limit) throws SQLException {
		// TODO Auto-generated method stub
		List<Object> articleList=new ArrayList<>();
		DBUtil dbUtil = new DBUtil();
		String sql = "SELECT * FROM v_articleinfo LIMIT ?,?";
		PreparedStatement ps = dbUtil.getPreparedStatement(sql);
		ps.setInt(1, (page-1)*limit);
		ps.setInt(2, limit);
		ResultSet rs = ps.executeQuery();
		while (rs.next()) {
			Article article = new Article();
			article.setTitleId(rs.getInt("titleId"));
			article.setUserId(rs.getInt("userId"));
			article.setName(rs.getString("name"));
			article.setTopic(rs.getString("topic"));
			article.setModel(rs.getString("model"));;
			article.setUploadTime(rs.getString("uploadTime"));
			article.setRelease(rs.getInt("release"));
			article.setViews(rs.getInt("views"));
			article.setLikes(rs.getInt("likes"));
			articleList.add(article);
		}
		return articleList;
	}
	//所有文章数量
	@Override
	public int countArticle() throws SQLException {
		// TODO Auto-generated method stub
		DBUtil dbUtil = new DBUtil();
		String sql = "SELECT count(*) as sum FROM v_articleinfo";
		Connection conn = dbUtil.getConnection();
		// 没有?占位符，用Statement
		Statement st = conn.createStatement();
		ResultSet rs = st.executeQuery(sql);
		while (rs.next()) {
			return rs.getInt("sum");
		}
		return 0;
	}
	//根据关键词搜索
	@Override
	public int searchArticle(Article article, int page, int limit) {
		// TODO Auto-generated method stub
		List<Object> articleList=new ArrayList<>();
		DBUtil dbUtil = new DBUtil();
		String sql = "SELECT * FROM v_articleinfo LIMIT ?,?";
		PreparedStatement ps = dbUtil.getPreparedStatement(sql);
		ps.setInt(1, (page-1)*limit);
		ps.setInt(2, limit);
		ResultSet rs = ps.executeQuery();
		while (rs.next()) {
			Article searchArticle = new Article();
			article.setTitleId(rs.getInt("titleId"));
			article.setUserId(rs.getInt("userId"));
			article.setName(rs.getString("name"));
			article.setTopic(rs.getString("topic"));
			article.setModel(rs.getString("model"));;
			article.setUploadTime(rs.getString("uploadTime"));
			article.setRelease(rs.getInt("release"));
			article.setViews(rs.getInt("views"));
			article.setLikes(rs.getInt("likes"));
			articleList.add(article);
		}
		return articleList;
	}

}
