<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>手机</title>
    <link href="../../layui/css/layui.css" rel="stylesheet">
    <script src="../../layui/layui.js"></script>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <style>
       .hide-dropdown {
            display: none;
        }

        html,
        body {
            /* overflow-x: hidden; */
            overflow: hidden;
        }
    </style>
</head>

<body>
    <form class="layui-form layui-row layui-col-space16">
        <div class="layui-form-item">
            <div class="layui-input-inline">
                <div class="layui-inline">
                    <input type="text" name="titleId" value="" placeholder="文章ID"
                        class="layui-input" lay-affix="clear" style="width: 150px;">
                </div>
            </div>

            <div class="layui-input-inline">
                <div class="layui-inline">
                    <input type="text" name="topic" placeholder="标题" lay-affix="clear"
                        class="layui-input" style="width: 150px;">
                </div>
            </div>

            <div class="layui-input-inline">
                <div class="layui-inline">
                    <input type="text" name="name" placeholder="作者" lay-affix="clear"
                        class="layui-input" style="width: 150px;">
                </div>
            </div>

            <div class="layui-input-inline">
                <div class="layui-btn-container layui-col-xs12">
                    <button class="layui-btn" lay-submit lay-filter="demo-table-search">
                        <i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>
                    </button>
                </div>
            </div>
        </div>
    </form>
    <table class="layui-hide" id="ID-table-demo-search"></table>


    <script>
        layui.use(function () {
            var table = layui.table;
            var form = layui.form;
            var laydate = layui.laydate;
            var dropdown = layui.dropdown;

            // 初始化表格
            table.init('ID-table-demo-search', {
                cols: [
                    [
                        {
                            field: 'titleId',
                            title: '文章ID',
                            width: 150,
                            sort: true,
                            fixed: true
                        },
                        {
                            field: 'topic',
                            title: '标题',
                            width: 740,
                            templet: function (d) {
                                var link = "CurrentArticle.html?titleId=" + d.titleId;
                                return '<a href="' + link + '">' + d.topic + '</a>';
                            }
                        },
                        {
                            field: 'name',
                            title: '作者',
                            width: 120,
                            sort: true
                        },
                        {
                            field: 'uploadTime',
                            title: '发布日期',
                            width: 200,
                            sort: true
                        },
                        {
                            field:'model',
                            title: '机型',
                            width: 100
                        },
                        {
                            field: 'views',
                            title: '浏览量',
                            width: 100
                        },
                        {
                            field: 'likes',
                            title: '点赞量',
                            width: 100
                        }
                    ]
                ],
                height: 'full-55',
                done: function (res, curr, count) {
                    if (res.data.length < 30 && count > res.data.length) {
                        // 如果当前数据量小于每页数据量且总数据量大于当前数据量，则表示没有更多数据了
                        $('.layui-table-view').removeAttr('lay-loading');
                    }
                }
            });

            // 滚动加载数据
            var currPage = 1;
            var loading = false;
            $(window).scroll(function () {
                var scrollTop = $(this).scrollTop();
                var scrollHeight = $(document).height();
                var clientHeight = $(this).height();
                if (scrollTop + clientHeight >= scrollHeight &&!loading) {
                    loading = true;
                    currPage++;
                    var field = {};
                    field.model = '手机';
                    table.load('ID-table-demo-search', {
                        page: {
                            curr: currPage
                        },
                        url: '../../SelectPhoneArticleServlet',
                        where: field,
                        done: function (res, curr, count) {
                            if (res.data.length < 30) {
                                // 如果当前数据量小于每页数据量，则表示没有更多数据了
                                $('.layui-table-view').removeAttr('lay-loading');
                            }
                            loading = false;
                        }
                    });
                }
            });

            // 搜索提交
            form.on('submit(demo-table-search)', function (data) {
                var field = data.field;
                field.model = '手机';
                currPage = 1;
                // 重新初始化表格并加载第一页数据
                table.init('ID-table-demo-search', {
                    cols: [
                        [
                            {
                                field: 'titleId',
                                title: '文章ID',
                                width: 150,
                                sort: true,
                                fixed: true
                            },
                            {
                                field: 'topic',
                                title: '标题',
                                width: 740,
                                templet: function (d) {
                                    var link = "CurrentArticle.html?titleId=" + d.titleId;
                                    return '<a href="' + link + '">' + d.topic + '</a>';
                                }
                            },
                            {
                                field: 'name',
                                title: '作者',
                                width: 120,
                                sort: true
                            },
                            {
                                field: 'uploadTime',
                                title: '发布日期',
                                width: 200,
                                sort: true
                            },
                            {
                                field:'model',
                                title: '机型',
                                width: 100
                            },
                            {
                                field: 'views',
                                title: '浏览量',
                                width: 100
                            },
                            {
                                field: 'likes',
                                title: '点赞量',
                                width: 100
                            }
                        ]
                    ],
                    height: 'full-55',
                    done: function (res, curr, count) {
                        if (res.data.length < 30 && count > res.data.length) {
                            // 如果当前数据量小于每页数据量且总数据量大于当前数据量，则表示没有更多数据了
                            $('.layui-table-view').removeAttr('lay-loading');
                        }
                    }
                });
                // 执行搜索重载
                table.load('ID-table-demo-search', {
                    page: {
                        curr: 1 // 重新从第 1 页开始
                    },
                    url: '../../SearchArticleServlet',
                    where: field // 搜索的字段
                });
                return false; // 阻止默认 form 跳转
            });
        });
    </script>

</body>

</html>