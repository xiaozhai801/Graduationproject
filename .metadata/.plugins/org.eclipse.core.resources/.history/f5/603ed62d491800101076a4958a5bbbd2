<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>个人信息</title>
<link href=".//layui/css/layui.css" rel="stylesheet">
<script src=".//layui/layui.js"></script>
<script src=".//js/jquery-3.6.0.min.js"></script>
</head>

<body>
	<form class="layui-form layui-form-pane" action="">
		<div class="layui-form-item">
			<label class="layui-form-label">我的角色</label>
			<div class="layui-input-inline">
				<select name="role" lay-verify="">
					<option value="1">用户</option>
					<option value="2">管理员</option>
				</select>
			</div>
			<div class="layui-form-mid layui-word-aux">当前角色不可更改为其它角色</div>
		</div>

		<div class="layui-form-item">
			<label class="layui-form-label">用户名</label>
			<div class="layui-input-inline">
				<input type="text" name="name" readonly="" class="layui-input">
			</div>
			<div class="layui-form-mid layui-word-aux">不可修改</div>
		</div>

		<div class="layui-form-item">
			<label class="layui-form-label">昵称</label>
			<div class="layui-input-inline">
				<input type="text" name="nickname" lay-verify="nickname"
					autocomplete="off" placeholder="请输入昵称" class="layui-input">
			</div>
			<div class="layui-form-mid layui-word-aux">你在网站中显示的名称</div>
		</div>

		<div class="layui-form-item">
			<label class="layui-form-label">性别</label>
			<div class="layui-input-block">
				<input type="radio" name="sex" value="男" title="男"> <input
					type="radio" name="sex" value="女" title="女"> <input
					type="radio" name="sex" value="不透露" title="不透露">
			</div>
		</div>

		<div class="layui-form-item">
			<label class="layui-form-label">邮箱</label>
			<div class="layui-input-inline">
				<input type="text" name="email" lay-verify="email"
					autocomplete="off" class="layui-input">
			</div>
		</div>

		<div class="layui-form-item">
			<button class="layui-btn" lay-submit lay-filter="demo2">确认</button>
			<button type="reset" class="layui-btn layui-btn-primary">重置</button>
		</div>
	</form>

	<script>
        layui.use(['form', 'layer'], function () {
            var form = layui.form;
            var layer = layui.layer;

            // 发送 AJAX 请求获取后端数据
            $.ajax({
                type: 'GET', // 根据后端接口的要求选择请求方法，如 GET、POST 等
                url: 'SelectPersonalInfoServlet', // 替换为实际的后端 API 接口 URL
                dataType: 'json', // 预期后端返回的数据类型为 JSON
                success: function (response) {
                    // 获取表单数据并填充
                    var userData = response.data[0];
                    // 处理 userId 为空的情况
                    var userId = userData.userId || "";
                    $("input[name='name']").val(userId);
                    // 处理 name 为空的情况
                    var name = userData.name || "";
                    $("input[name='nickname']").val(name);
                    // 处理 sex 为空的情况
                    var sex = userData.sex || "不透露";
                    $("input[name='sex'][value='" + sex + "']").prop('checked', true);

                    // 处理 email 为空的情况
                    var email = userData.email || "";
                    $("input[name='email']").val(email);

                    $("select[name='role']").val(userData.role === 'user'? '1' : '2');

                    // 更新表单状态
                    form.render();
                }
            });

            // 提交事件
            form.on('submit(demo2)', function (data) {
                var field = data.field;
                // 显示填写结果，仅作演示用
                layer.alert(JSON.stringify(field), {
                    title: '当前填写的字段值'
                });
                
    			$.ajax({
    				url : 'EditUserServlet?userId=' + data.userId + '&name=' + data.name
    						+ '&sex=' + data.sex + '&age=' + data.age + '&email='
    						+ data.email,//通讯地址
    				type : 'post',//get或者post 
    				contentType : "application/json;charset=UTF-8",
    				data : {
    					'userId' : data.userId,
    					'name' : data.name,
    					'sex' : data.sex,
    					'age' : data.age,
    					'email' : data.email
    				},//发送到服务端的数据K-V形式
    				dataType : "text",//接收到的数据的类型可以是json或者text
    				success : function(res) {
    					if (res == "success") {
    						layer.msg('修改成功', {
    							icon : 1, // 显示成功图标
    							time : 2000
    						// 提示信息显示 2 秒
    						});
    					} else {
    						layer.msg('修改失败', {
    							icon : 2, // 显示成功图标
    							time : 2000
    						// 提示信息显示 2 秒
    						});
    					}
    				}
    			});

                return false;
            });
        });
    </script>
</body>

</html>