package com.zpq.dao;

import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

import com.zpq.pojo.User;
import com.zpq.utils.DBUtil;

public class UserAddDaoImpl implements UserAddDao {

	@Override
	public String addUser(String name, String password) throws SQLException {
		// TODO Auto-generated method stub
		User user = new User();
		DBUtil dbUtil = new DBUtil();
		String sql = "select * from s_user where name=?";
		PreparedStatement ps = dbUtil.getPreparedStatement(sql);
		ps.setString(1, name);
		ResultSet rs = ps.executeQuery();
		rs.next();
		System.out.println(rs.getString("name"));
		//name存在返回null
		if (name.equals(rs.getString("name"))) {
			return null;
		} 
		
		sql = "INSERT INTO s_user (NAME, PASSWORD, userId) VALUES(?,?,(SELECT userId FROM(SELECT userId,ROW_NUMBER () OVER (ORDER BY id DESC) AS row_num	FROM s_user) subquery WHERE	row_num = 1)+1);";
		ps.setString(1, name);
		ps.setString(2, password);
		ps.executeQuery();
		return "success";
	}
}
